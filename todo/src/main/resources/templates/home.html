<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	<th:block>
		<h1>할 일 목록</h1>
		
		<div class="search">
			<form>
				<label for="search_text">내용 : </label>
				<input type="text" id="search_text" name="search_text">
				<input type="submit" value="검색">
			</form>	
		</div>
		<br>
		<div class="todo_list">
			<form>
				<table border="1">
					<thead>
						<tr>
							<th>완료</th>
							<th>번호</th>
							<th>내용</th>
							<th>삭제</th>
						
						</tr>
					</thead>
					<tbody>
						<tr th:if="${!#lists.isEmpty(todoList)}"
							th:each="todo, todoStatus : ${todoList}">
							<td><input type="checkbox" name="complete" id="complete"></td>
							<td th:text="${(pageDto.nowPage-1)*(pageDto.numPerPage)+todoStatus.count}">번호</td>
							<td th:text="${todo.content}">내용</td>
							<td>
								<button id="delete_btn"
									th:onclick="|javascript:todoDelete('${todo.no}')|">
									삭제
								</button>
							</td>
						</tr>
						<tr th:if="${todoList.isEmpty}">
							<td colspan="4">조회된 데이터가 없습니다.</td>
						</tr>
					</tbody>
				
				</table>
			
			</form>
		</div>
		
		<div class="center">
			<div class="pagination">
				<a th:if="${pageDto.prev}"
					th:href="@{/(nowPage=${pageDto.pageBarStart-1},search_text=${searchDto.search_text})}">
					&laquo;
				</a>
				<a th:each="num : ${#numbers.sequence(pageDto.pageBarStart,pageDto.pageBarEnd)}"
					th:text="${num}"
					th:href="@{/(nowPage=${num},search_text=${searchDto.search_text})}">
					번호
				</a>
				<a th:if="${pageDto.next}"
					th:href="@{/(nowPage=${pageDto.pageBarEnd+1},search_text=${searchDto.search_text})}">
					&raquo;
				</a>			
			</div>
		</div>
		
		<h1>할 일 추가</h1>
		<div class="plus_todo_form">
			<form action="/todo" name="create_todo_form" method="post" enctype="multipart/form-data">
				<input type="hidden" name="no">
				<input type="text" name="content" id="content" placeholder="할일을 입력하세요.">
				<input type="hidden" name="flag" value="N">
				<input type="submit" value="추가하기">
			</form>
		</div>
		
		
		
		
		
		<script>
			const form = document.create_todo_form;
			form.addEventListener('submit',(e)=>{
				e.preventDefault(); 
				
				let vali_check = false; 
				let vali_text = "";
				
				if(!form.content.value){
					vali_text += "할일을 입력하세요";
					form.content.focus();
				}else{
					vali_check = true;
				}
				
				if(vali_check == false){
					alert(vali_text);
				}else{
					const payload = new FormData(form);
					fetch("/todo",{
						method:'post',
						body:payload
					})
					.then(response => response.json())
					.then(data =>{
						alert(data.res_msg);
					})
					
					document.getElementById('content').value="";
				}
				
			})
			
			
			// 삭제
			const todoDelete = function(no){
				// console.log(no);
				
				let check = confirm("삭제하시겠습니까?");
				
				if(check){
					fetch('/todo/'+no+"/delete",{
						method:'delete',
					})
					.then(response => response.json())
					.then(data => {
						alert(data.res_msg);
					})
				}
			}
		
		</script>
	</th:block>
</html>